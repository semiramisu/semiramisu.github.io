---
import { Icon } from "astro-icon/components";

export interface Props {
  title: string;
  url: string;
  description?: string;
}

const { title, url, description = "" } = Astro.props;

// URLエンコード
const encodedUrl = encodeURIComponent(url);
const encodedTitle = encodeURIComponent(title);
const encodedDescription = encodeURIComponent(description);

// 各SNSのシェアURL
const shareUrls = {
  twitter: `https://twitter.com/intent/tweet?text=${encodedTitle}&url=${encodedUrl}`,
  facebook: `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`,
  line: `https://social-plugins.line.me/lineit/share?url=${encodedUrl}`,
  hatena: `https://b.hatena.ne.jp/entry/${encodedUrl}`,
  pocket: `https://getpocket.com/save?url=${encodedUrl}&title=${encodedTitle}`,
};
---

<div class="share-buttons">
  <span class="share-label">この記事をシェア</span>
  <div class="share-buttons-list">
    <a
      href={shareUrls.twitter}
      target="_blank"
      rel="noopener noreferrer"
      class="share-button twitter"
      aria-label="Xでシェア"
      title="Xでシェア"
    >
      <Icon name="line-md:twitter-x" />
    </a>
    <a
      href={shareUrls.facebook}
      target="_blank"
      rel="noopener noreferrer"
      class="share-button facebook"
      aria-label="Facebookでシェア"
      title="Facebookでシェア"
    >
      <svg class="facebook-icon" viewBox="0 0 24 24" width="20" height="20">
        <path fill="currentColor" d="M14 13.5h2.5l1-4H14v-2c0-1.03 0-2 2-2h1.5V2.14c-.326-.043-1.557-.14-2.857-.14C11.928 2 10 3.657 10 6.7v2.8H7v4h3V22h4v-8.5z"/>
      </svg>
    </a>
    <a
      href={shareUrls.line}
      target="_blank"
      rel="noopener noreferrer"
      class="share-button line"
      aria-label="LINEでシェア"
      title="LINEでシェア"
    >
      <svg class="line-icon" viewBox="0 0 24 24" width="20" height="20">
        <path fill="currentColor" d="M19.365 9.863c.349 0 .63.285.63.631c0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63c0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346 0 .627.285.627.63c0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596c-.064.021-.133.031-.199.031c-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629c-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595c.06-.023.136-.033.194-.033c.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63c.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63c.346 0 .628.285.628.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63c.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63c0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608c.391.082.923.258 1.058.59c.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645c1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/>
      </svg>
    </a>
    <a
      href={shareUrls.hatena}
      target="_blank"
      rel="noopener noreferrer"
      class="share-button hatena"
      aria-label="はてなブックマークに追加"
      title="はてなブックマークに追加"
    >
      <svg class="hatena-icon" viewBox="0 0 24 24" width="20" height="20">
        <path d="M20.47 0C22.42 0 24 1.58 24 3.53v16.94c0 1.95-1.58 3.53-3.53 3.53H3.53C1.58 24 0 22.42 0 20.47V3.53C0 1.58 1.58 0 3.53 0h16.94zM8.88 17.9a5.42 5.42 0 0 1-2.36-.52c-.72-.34-1.29-.8-1.7-1.39-.42-.58-.7-1.24-.85-1.99-.15-.74-.23-1.52-.23-2.32 0-.83.09-1.6.25-2.31.17-.71.44-1.33.82-1.86.38-.52.88-.94 1.5-1.24.63-.3 1.39-.45 2.3-.45.78 0 1.44.1 1.97.29.54.19.96.44 1.28.74.31.3.54.63.68.98.13.36.2.7.2 1.03 0 .42-.13.78-.37 1.08-.25.3-.59.44-1.03.44-.4 0-.73-.1-.98-.33-.25-.22-.44-.53-.58-.93a2.46 2.46 0 0 0-.28-.63.87.87 0 0 0-.4-.34 1.75 1.75 0 0 0-.65-.1c-.43 0-.77.1-1.01.3-.25.2-.45.48-.6.82-.14.34-.24.73-.3 1.17-.05.44-.07.89-.07 1.35 0 .49.02.96.08 1.4.05.45.15.84.28 1.19.13.35.33.63.58.84.25.2.58.31 1.02.31.5 0 .89-.2 1.17-.6.27-.4.44-.95.5-1.65.02-.33.12-.6.28-.78.16-.18.46-.28.89-.28.36 0 .65.1.86.3.22.2.32.52.32.94 0 .42-.1.87-.28 1.34-.18.47-.47.9-.86 1.3-.4.38-.9.7-1.53.95-.62.25-1.39.37-2.29.37zm7.3.1c-.56 0-1-.18-1.34-.56-.33-.37-.5-.88-.5-1.52V8.29c0-.64.17-1.15.5-1.52.33-.37.78-.56 1.34-.56.55 0 1 .19 1.33.56.34.37.5.88.5 1.52v7.63c0 .64-.16 1.15-.5 1.52-.33.38-.78.56-1.33.56zm0-10.82c-.43 0-.8-.14-1.08-.41a1.33 1.33 0 0 1-.43-1c0-.39.14-.72.43-1 .29-.27.65-.41 1.08-.41.44 0 .8.14 1.08.41.29.28.43.61.43 1s-.14.73-.43 1c-.28.27-.64.41-1.08.41z"/>
      </svg>
    </a>
    <a
      href={shareUrls.pocket}
      target="_blank"
      rel="noopener noreferrer"
      class="share-button pocket"
      aria-label="Pocketに保存"
      title="Pocketに保存"
    >
      <svg class="pocket-icon" viewBox="0 0 24 24" width="20" height="20">
        <path fill="currentColor" d="M18.813 10.259l-5.646 5.419a1.649 1.649 0 0 1-2.282 0l-5.646-5.419a1.645 1.645 0 0 1 2.276-2.376l4.511 4.322l4.517-4.322a1.643 1.643 0 0 1 2.326.049a1.64 1.64 0 0 1-.045 2.326l-.011.001zm3.93-7.48C22.178 1.109 20.486 0 18.596 0H5.406C3.516 0 1.824 1.109 1.26 2.778A4.748 4.748 0 0 0 .906 4.44v7.124c0 3.522 1.91 6.779 5.003 8.505a11.946 11.946 0 0 0 6.093 1.663a11.981 11.981 0 0 0 5.13-1.15a11.903 11.903 0 0 0 1.03-.535c3.032-1.754 4.932-5.009 4.932-8.483V4.44a4.75 4.75 0 0 0-.354-1.661h.003z"/>
      </svg>
    </a>
    <button
      class="share-button copy-link"
      aria-label="リンクをコピー"
      title="リンクをコピー"
      data-url={url}
    >
      <svg class="link-icon" viewBox="0 0 24 24" width="20" height="20">
        <path fill="currentColor" d="M11 17H7q-2.075 0-3.537-1.463T2 12q0-2.075 1.463-3.537T7 7h4v2H7q-1.25 0-2.125.875T4 12q0 1.25.875 2.125T7 15h4zm-3-4v-2h8v2zm5 4v-2h4q1.25 0 2.125-.875T20 12q0-1.25-.875-2.125T17 9h-4V7h4q2.075 0 3.537 1.463T22 12q0 2.075-1.463 3.537T17 17z"/>
      </svg>
    </button>
  </div>
</div>

<style>
  .share-buttons {
    margin: 2rem 0;
    padding: 1.5rem;
    background-color: var(--card-color);
    border-radius: 0.75rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .share-label {
    font-size: 0.875rem;
    color: var(--text-color-lighten);
    font-weight: 500;
  }

  .share-buttons-list {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .share-button {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background-color: var(--bg-color);
    color: var(--text-color);
    transition: all 0.3s ease;
    text-decoration: none;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .share-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
  }

  .share-button:active {
    transform: translateY(0);
  }

  /* SNS別の色設定 */
  .share-button.twitter:hover {
    background-color: #000000;
    color: #ffffff;
  }

  .share-button.facebook:hover {
    background-color: #1877f2;
    color: #ffffff;
  }

  .share-button.line:hover {
    background-color: #00c300;
    color: #ffffff;
  }

  .share-button.hatena:hover {
    background-color: #00a4de;
    color: #ffffff;
  }

  .share-button.pocket:hover {
    background-color: #ef3f56;
    color: #ffffff;
  }

  .share-button.copy-link:hover {
    background-color: var(--primary-color);
    color: #ffffff;
  }

  .share-button.copy-link.copied {
    background-color: var(--primary-color);
    color: #ffffff;
  }

  .hatena-icon,
  .facebook-icon,
  .line-icon,
  .pocket-icon,
  .link-icon {
    fill: currentColor;
  }

  /* モバイル対応 */
  @media (max-width: 768px) {
    .share-buttons {
      padding: 1rem;
    }

    .share-button {
      width: 36px;
      height: 36px;
    }
  }
</style>

<script>
  function setupCopyLink() {
    const copyButtons = document.querySelectorAll('.copy-link');
    
    copyButtons.forEach(button => {
      button.addEventListener('click', async () => {
        const url = button.getAttribute('data-url');
        if (!url) return;
        
        try {
          await navigator.clipboard.writeText(url);
          button.classList.add('copied');
          
          // アイコンを一時的に変更
          const icon = button.querySelector('svg');
          if (icon) {
            const originalHTML = icon.outerHTML;
            icon.outerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="currentColor" d="m9 16.17l-4.17-4.17l-1.42 1.41L9 19L21 7l-1.41-1.41z"/></svg>';
            
            setTimeout(() => {
              const newIcon = button.querySelector('svg');
              if (newIcon) {
                newIcon.outerHTML = originalHTML;
              }
              button.classList.remove('copied');
            }, 2000);
          }
        } catch (err) {
          console.error('Failed to copy URL:', err);
        }
      });
    });
  }

  // ページ読み込み時と遷移時に実行
  document.addEventListener('DOMContentLoaded', setupCopyLink);
  document.addEventListener('astro:after-swap', setupCopyLink);
</script>